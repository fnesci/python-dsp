
# HB Notes:
# N must be Odd
# N/2 + 1 is Non-zero
# N/2 + 2 + 2i for i >= 0 is Non-zero
class HbFilter:
    def __init__(self, b):
        self.__b = b
        self.__N = len(b)
        self.__N_minus_1 = self.__N - 1
        self.__history = [0] * self.__N
        self.__head = 0
        self.__emit = True
        self.__r0_start =  0 if self.__N/2 & 1 == 0 else 1
        self.__r0_end = self.__N / 2
        self.__r1_start = self.__N / 2 + 1
        self.__r1_end = self.__N - 1 - self.__r0_start

    def N(self):
         return self.__N

    def next(self, x):
        self.__emit ^= 1
        self.__history[self.__head] = x

        if (self.__emit):
            y = 0.0
            k = 0
            # i = self.__r0_start
            # while i < self.__r0_end:
            for i in range(self.__head, self.__N):
                y += self.__b[k] * self.__history[i]
                k += 1
                i += 2

            for i in range(0, self.__head):
                y += self.__b[k] * self.__history[i]
                k += 1

            self.__head -= 1
            if self.__head < 0:
                self.__head = self.__N_minus_1

            return True, y

        return False, None

    def block_next(self, xs, ys):
        for x in xs:
            self.__emit ^= 1
            self.__history[self.__head] = x

            if self.__emit:
                y = 0.0
                k = 0
                for i in range(self.__head, self.__N):
                    y += self.__b[k] * self.__history[i]
                    k +=1

                for i in range(0, self.__head):
                    y += self.__b[k] * self.__history[i]
                    k +=1

                self.__head -= 1
                if self.__head < 0:
                    self.__head = self.__N_minus_1

                ys.append(y)



# The filters were created on https://fiiir.com/
# Other filter site: https://www-users.cs.york.ac.uk/~fisher/mkfilter/

# Stopband attenuation = 60 dB, Transition region = 0.08
default_hb = [
    -0.000282249928167289,
    0.000000000000000003,
    0.000878388825514194,
    -0.000000000000000002,
    -0.001940681898995611,
    0.000000000000000003,
    0.003658046923504537,
    -0.000000000000000005,
    -0.006267387508492925,
    0.000000000000000007,
    0.010083822362591324,
    -0.000000000000000009,
    -0.015575143815889954,
    0.000000000000000012,
    0.023549978760621523,
    -0.000000000000000014,
    -0.035684861763036611,
    0.000000000000000016,
    0.056332054748040108,
    -0.000000000000000018,
    -0.101568109701556511,
    0.000000000000000019,
    0.316796251746658319,
    0.500039782498417740,
    0.316796251746658319,
    0.000000000000000019,
    -0.101568109701556622,
    -0.000000000000000018,
    0.056332054748040108,
    0.000000000000000016,
    -0.035684861763036611,
    -0.000000000000000014,
    0.023549978760621523,
    0.000000000000000012,
    -0.015575143815889954,
    -0.000000000000000009,
    0.010083822362591324,
    0.000000000000000007,
    -0.006267387508492925,
    -0.000000000000000005,
    0.003658046923504537,
    0.000000000000000003,
    -0.001940681898995612,
    -0.000000000000000002,
    0.000878388825514194,
    0.000000000000000003,
    -0.000282249928167289,
]

half_band_015_40 = [
    -0.000000000000000003,
    -0.012161324817008181,
    0.000000000000000008,
    0.034981693598032444,
    -0.000000000000000013,
    -0.086839746354898925,
    0.000000000000000018,
    0.312814128570580330,
    0.502410498006588435,
    0.312814128570580330,
    0.000000000000000018,
    -0.086839746354898925,
    -0.000000000000000013,
    0.034981693598032444,
    0.000000000000000008,
    -0.012161324817008181,
    -0.000000000000000003,
]

half_band_015_50 = [
    0.000000000000000001,
    0.004397531463814790,
    -0.000000000000000004,
    -0.014951880421542038,
    0.000000000000000009,
    0.037448635362423224,
    -0.000000000000000014,
    -0.088217569314232566,
    0.000000000000000018,
    0.311624303430475036,
    0.499397958958123056,
    0.311624303430475036,
    0.000000000000000018,
    -0.088217569314232566,
    -0.000000000000000014,
    0.037448635362423224,
    0.000000000000000009,
    -0.014951880421542038,
    -0.000000000000000004,
    0.004397531463814794,
    0.000000000000000001,
]

half_band_015_60 = [
    0.000499374150228484,
    -0.000000000000000001,
    -0.002910301964518417,
    0.000000000000000003,
    0.008730509716546044,
    -0.000000000000000007,
    -0.020464861178694685,
    0.000000000000000011,
    0.043000988437639803,
    -0.000000000000000015,
    -0.092424114104037336,
    0.000000000000000018,
    0.313544061336781921,
    0.500048687212108267,
    0.313544061336781921,
    0.000000000000000018,
    -0.092424114104037336,
    -0.000000000000000015,
    0.043000988437639803,
    0.000000000000000011,
    -0.020464861178694671,
    -0.000000000000000007,
    0.008730509716546044,
    0.000000000000000003,
    -0.002910301964518415,
    -0.000000000000000001,
    0.000499374150228484,
]

half_band_015_70 = [
    -0.000157840988773530,
    0.000000000000000000,
    0.001205100496935013,
    -0.000000000000000002,
    -0.004082385751355602,
    0.000000000000000004,
    0.010299065814581130,
    -0.000000000000000008,
    -0.022214788428367067,
    0.000000000000000012,
    0.044612138882742576,
    -0.000000000000000016,
    -0.093553967179023687,
    0.000000000000000018,
    0.313907929384430684,
    0.499969495537660791,
    0.313907929384430684,
    0.000000000000000018,
    -0.093553967179023687,
    -0.000000000000000016,
    0.044612138882742576,
    0.000000000000000012,
    -0.022214788428367084,
    -0.000000000000000008,
    0.010299065814581124,
    0.000000000000000004,
    -0.004082385751355602,
    -0.000000000000000002,
    0.001205100496935013,
    0.000000000000000000,
    -0.000157840988773530,
]

half_band_015_80 = [
    0.000050055961546464,
    0.000000000000000000,
    -0.000494652043197498,
    0.000000000000000001,
    0.001886195835906780,
    -0.000000000000000002,
    -0.005156279398677295,
    0.000000000000000005,
    0.011705047273485742,
    -0.000000000000000008,
    -0.023769776884217463,
    0.000000000000000012,
    0.046042876536210108,
    -0.000000000000000016,
    -0.094569652930969209,
    0.000000000000000019,
    0.314299393772626889,
    0.500013583754570834,
    0.314299393772626889,
    0.000000000000000019,
    -0.094569652930969209,
    -0.000000000000000016,
    0.046042876536210108,
    0.000000000000000012,
    -0.023769776884217442,
    -0.000000000000000008,
    0.011705047273485751,
    0.000000000000000005,
    -0.005156279398677295,
    -0.000000000000000002,
    0.001886195835906780,
    0.000000000000000001,
    -0.000494652043197498,
    0.000000000000000000,
    0.000050055961546464,
]

half_band_015_90 = [
    0.000050055961546464,
    0.000000000000000000,
    -0.000494652043197498,
    0.000000000000000001,
    0.001886195835906780,
    -0.000000000000000002,
    -0.005156279398677295,
    0.000000000000000005,
    0.011705047273485742,
    -0.000000000000000008,
    -0.023769776884217463,
    0.000000000000000012,
    0.046042876536210108,
    -0.000000000000000016,
    -0.094569652930969209,
    0.000000000000000019,
    0.314299393772626889,
    0.500013583754570834,
    0.314299393772626889,
    0.000000000000000019,
    -0.094569652930969209,
    -0.000000000000000016,
    0.046042876536210108,
    0.000000000000000012,
    -0.023769776884217442,
    -0.000000000000000008,
    0.011705047273485751,
    0.000000000000000005,
    -0.005156279398677295,
    -0.000000000000000002,
    0.001886195835906780,
    0.000000000000000001,
    -0.000494652043197498,
    0.000000000000000000,
    0.000050055961546464,
]

half_band_010_40 = [
    -0.000000000000000003,
    -0.006516192064016200,
    0.000000000000000006,
    0.014280311428581572,
    -0.000000000000000010,
    -0.027151498821544103,
    0.000000000000000013,
    0.049507622881582232,
    -0.000000000000000017,
    -0.097347574494857106,
    0.000000000000000019,
    0.316324531370552109,
    0.501805599399402946,
    0.316324531370552109,
    0.000000000000000019,
    -0.097347574494857106,
    -0.000000000000000017,
    0.049507622881582232,
    0.000000000000000013,
    -0.027151498821544103,
    -0.000000000000000010,
    0.014280311428581572,
    0.000000000000000006,
    -0.006516192064016197,
    -0.000000000000000003,
]

half_band_010_50 = [
    -0.001178473692574437,
    0.000000000000000002,
    0.003740979564773994,
    -0.000000000000000004,
    -0.008387774985024462,
    0.000000000000000007,
    0.016134752576264587,
    -0.000000000000000011,
    -0.028788840404187166,
    0.000000000000000014,
    0.050723544745117831,
    -0.000000000000000017,
    -0.097916966956756613,
    0.000000000000000019,
    0.315593394238178060,
    0.500158769828416450,
    0.315593394238178060,
    0.000000000000000019,
    -0.097916966956756613,
    -0.000000000000000017,
    0.050723544745117831,
    0.000000000000000014,
    -0.028788840404187180,
    -0.000000000000000011,
    0.016134752576264580,
    0.000000000000000007,
    -0.008387774985024462,
    -0.000000000000000004,
    0.003740979564773994,
    0.000000000000000002,
    -0.001178473692574437,
]

half_band_010_60 = [
    -0.000341660358758696,
    0.000000000000000001,
    0.001280145288926233,
    -0.000000000000000002,
    -0.003112851035778237,
    0.000000000000000004,
    0.006275882317150588,
    -0.000000000000000006,
    -0.011359851511041593,
    0.000000000000000009,
    0.019275135606203555,
    -0.000000000000000012,
    -0.031757778214681620,
    0.000000000000000015,
    0.053162475901186709,
    -0.000000000000000017,
    -0.099505973567768677,
    0.000000000000000019,
    0.316072346004351412,
    0.500024259140420702,
    0.316072346004351412,
    0.000000000000000019,
    -0.099505973567768677,
    -0.000000000000000017,
    0.053162475901186709,
    0.000000000000000015,
    -0.031757778214681620,
    -0.000000000000000012,
    0.019275135606203569,
    0.000000000000000009,
    -0.011359851511041593,
    -0.000000000000000006,
    0.006275882317150588,
    0.000000000000000004,
    -0.003112851035778237,
    -0.000000000000000002,
    0.001280145288926234,
    0.000000000000000001,
    -0.000341660358758696,
]

half_band_010_70 = [
    0.000000000000000001,
    0.000259428403220702,
    -0.000000000000000001,
    -0.000849203973148259,
    0.000000000000000001,
    0.002020879602579480,
    -0.000000000000000003,
    -0.004080471846311796,
    0.000000000000000005,
    0.007428971790976757,
    -0.000000000000000007,
    -0.012622523505531592,
    0.000000000000000010,
    0.020543882895718769,
    -0.000000000000000013,
    -0.032913762438623602,
    0.000000000000000015,
    0.054087234736577880,
    -0.000000000000000018,
    -0.100096958105103814,
    0.000000000000000019,
    0.316241705500209302,
    0.499961633878872436,
    0.316241705500209302,
    0.000000000000000019,
    -0.100096958105103814,
    -0.000000000000000018,
    0.054087234736577880,
    0.000000000000000015,
    -0.032913762438623623,
    -0.000000000000000013,
    0.020543882895718752,
    0.000000000000000010,
    -0.012622523505531592,
    -0.000000000000000007,
    0.007428971790976757,
    0.000000000000000005,
    -0.004080471846311796,
    -0.000000000000000003,
    0.002020879602579480,
    0.000000000000000001,
    -0.000849203973148260,
    -0.000000000000000001,
    0.000259428403220702,
    0.000000000000000001,
]

half_band_010_80 = [
    0.000000000000000000,
    0.000086807846178276,
    0.000000000000000000,
    -0.000313520948115462,
    0.000000000000000003,
    0.000796178310829601,
    -0.000000000000000001,
    -0.001690266959394461,
    0.000000000000000003,
    0.003200175021546325,
    -0.000000000000000004,
    -0.005589922435708486,
    0.000000000000000006,
    0.009209574758274851,
    -0.000000000000000009,
    -0.014563690155020393,
    0.000000000000000011,
    0.022492406766752140,
    -0.000000000000000014,
    -0.034691818990606187,
    0.000000000000000016,
    0.055516856888388887,
    -0.000000000000000018,
    -0.101027197956272241,
    0.000000000000000019,
    0.316579629808153629,
    0.499989576089986898,
    0.316579629808153629,
    0.000000000000000019,
    -0.101027197956272241,
    -0.000000000000000018,
    0.055516856888388887,
    0.000000000000000016,
    -0.034691818990606187,
    -0.000000000000000014,
    0.022492406766752140,
    0.000000000000000011,
    -0.014563690155020393,
    -0.000000000000000009,
    0.009209574758274851,
    0.000000000000000006,
    -0.005589922435708486,
    -0.000000000000000004,
    0.003200175021546329,
    0.000000000000000003,
    -0.001690266959394461,
    -0.000000000000000001,
    0.000796178310829601,
    0.000000000000000003,
    -0.000313520948115462,
    0.000000000000000000,
    0.000086807846178276,
    0.000000000000000000,
]

half_band_010_90 = [
    0.000000000000000000,
    0.000086807846178276,
    0.000000000000000000,
    -0.000313520948115462,
    0.000000000000000003,
    0.000796178310829601,
    -0.000000000000000001,
    -0.001690266959394461,
    0.000000000000000003,
    0.003200175021546325,
    -0.000000000000000004,
    -0.005589922435708486,
    0.000000000000000006,
    0.009209574758274851,
    -0.000000000000000009,
    -0.014563690155020393,
    0.000000000000000011,
    0.022492406766752140,
    -0.000000000000000014,
    -0.034691818990606187,
    0.000000000000000016,
    0.055516856888388887,
    -0.000000000000000018,
    -0.101027197956272241,
    0.000000000000000019,
    0.316579629808153629,
    0.499989576089986898,
    0.316579629808153629,
    0.000000000000000019,
    -0.101027197956272241,
    -0.000000000000000018,
    0.055516856888388887,
    0.000000000000000016,
    -0.034691818990606187,
    -0.000000000000000014,
    0.022492406766752140,
    0.000000000000000011,
    -0.014563690155020393,
    -0.000000000000000009,
    0.009209574758274851,
    0.000000000000000006,
    -0.005589922435708486,
    -0.000000000000000004,
    0.003200175021546329,
    0.000000000000000003,
    -0.001690266959394461,
    -0.000000000000000001,
    0.000796178310829601,
    0.000000000000000003,
    -0.000313520948115462,
    0.000000000000000000,
    0.000086807846178276,
    0.000000000000000000,
]